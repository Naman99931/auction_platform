<h1 style="font-size: 28px; color: #212121; margin-bottom: 20px;">Ongoing Auctions</h1>

<% @items.where("start_time < ? AND end_time > ?", Time.current, Time.current).each do |form| %>
    <div style="padding: 20px; width: 950px; margin: 20px auto; border-radius: 10px; box-shadow: 0px 5px 15px rgba(0, 0, 0, 0.1); background-color: #fff; display: flex; align-items: center;">
        
        <!-- Image Section -->
        <div style="width: 120px; height: 100px; margin-right: 20px; position: relative; overflow: hidden; border-radius: 5px;">
            <% if form.images.attached? %>
                <%= image_tag form.images.variant(:thumb), style: "width: 100%; height: 100%; object-fit: cover;" %>
            <% else %>
                <p style="color: #757575; text-align: center;">No image</p>
            <% end %>
            <span style="position: absolute; top: 5px; left: 5px; background: rgba(0, 0, 0, 0.6); color: #fff; padding: 2px 8px; font-size: 12px; border-radius: 3px;">
                <%= form.title %>
            </span>
        </div>

        <!-- Auction Details -->
        <div style="flex-grow: 1;">
            <p style="color: #424242; background-color: #E0E0E0; padding: 5px 10px; border-radius: 3px; display: inline-block; margin-bottom: 10px;"><%= form.item_description %></p>
            <p style="color: #616161; font-size: 14px; margin-bottom: 5px;">Started on: <%= form.start_time %></p>
            <p style="color: #616161; font-size: 14px;">Ends in: <strong><%= (form.end_time - Time.current).to_i %></strong> seconds</p>
            
        </div>

        <!-- Price Section -->
        <div style="border-left: 1px solid #E0E0E0; padding-left: 20px;">
            <p style="margin-bottom: 5px; font-weight: bold; color: #757575;">Base Price</p>
            <h4 style="color: #00B8D4; margin-bottom: 10px;"><%= form.reserved_price %></h4>
            <p style="margin-bottom: 5px; font-weight: bold; color: #757575;">Current Price</p>
            <h4 style="color: #00B8D4; margin-bottom: 0;"><%= form.current_price %></h4>
        </div>


        <br>
        <%= link_to "View Details", item_path(form.id) %>
        <br>
        <%=link_to "View this Auction", item_bids_path(form.id) %>
        <br>
        <% if current_user.role == "bidder" %>
            <% if (form.end_time - Time.current).to_i > 3600 %>
                
                <%= button_to "Set_alert", set_alert_path(form.id), method: :get, remote: true, class: "btn btn-primary" %>

            <% end %>
        <% end %>

        <% if form.end_time <= Time.current %>
             <% @item = Item.find(form.id) %>

             <% if @item.bids.last.present? %>
                <% winner_bid = @item.bids.last %>
                <% winner_bid.final_bid = true  %>
                <% winner = User.find(winner_bid.user_id) %>
                <% @item.winner_id = winner.id %>
                <% UserMailer.payment_alert(winner).deliver_now %>
                WinnerNotifyJob.perform_now(winner, @item)
             <% end %>
        <% end %>
             
    </div>
   
<% end %>

